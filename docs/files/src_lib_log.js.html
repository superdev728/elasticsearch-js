<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>src/lib/log.js - elasticsearch-js</title>
  <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
  <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.css">
  <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap-responsive.css">
  <link rel="stylesheet" href="../assets/css/main.css">
  <link rel="shortcut icon" type="image/png" href="../assets/img/favicon.png">
</head>
<body>
  <nav class="navbar navbar-default" role="navigation">
    <!-- Brand and toggle get grouped for better mobile display -->
    <a class="navbar-brand" href="#">elasticsearch-js</a>
    <p class="navbar-text">
      API Docs for Version: <b>0.0.1</b>
    </p>

    <form class="navbar-form navbar-right visible-md visible-large" role="search">
      <div class="form-group">
        <input type="text" class="form-control" placeholder="Search">
      </div>
    </form>
  </nav>
  <div class="container">
    <div class="row">
      <div class="col-md-3">
    	  <div>
  <h3>APIs</h3>
  <div id="sidebar">
    <ul id="main-nav" class="nav nav-tabs" style="margin-bottom:0;">
      
      <li class="active" style="visibility:hidden;"><a>just classes</a></li>
      
    </ul>

    <div id="api-tabview-filter">
      <input type="search" placeholder="Type to filter APIs">
    </div>

    <div class="tab-content" style="border: 1px solid #DDD; border-top:0;">
      <div class="tab-pane active" id="classes">
        <ul id="api-classes" class="nav nav-list">
          
            <li><a href="../classes/Client.html">Client</a></li>
          
            <li><a href="../classes/ConnectionPool.html">ConnectionPool</a></li>
          
            <li><a href="../classes/jQueryXhr.html">jQueryXhr</a></li>
          
            <li><a href="../classes/Log.html">Log</a></li>
          
            <li><a href="../classes/Loggers.File.html">Loggers.File</a></li>
          
            <li><a href="../classes/Loggers.Stdio.html">Loggers.Stdio</a></li>
          
            <li><a href="../classes/Loggers.Stream.html">Loggers.Stream</a></li>
          
            <li><a href="../classes/NodeHttp.html">NodeHttp</a></li>
          
            <li><a href="../classes/Transport.html">Transport</a></li>
          
            <li><a href="../classes/utils.html">utils</a></li>
          
        </ul>
      </div>
      
    </div>
  </div>
</div>

      </div>
      <div class="col-md-9">
        
        <div id="docs-main">
          <div class="content">
          <div class="page-header">
  <h1>src/lib/log.js <small>File</small></h1>
</div>

<div class="file">
  <pre class="prettyprint linenums">
var _ = require(&#x27;./utils&#x27;),
  EventEmitter = require(&#x27;events&#x27;).EventEmitter;

/**
 * Log bridge, which is an [EventEmitter](http://nodejs.org/api/events.html#events_class_events_eventemitter)
 * that sends events to one or more outputs/loggers. Setup these loggers by
 * specifying their config as the first argument, or by passing it to addOutput().
 *
 * @class Log
 * @uses Loggers.Stdio
 * @constructor
 * @param {string|Object|ArrayOfStrings|ArrayOfObjects} output - Either the level to setup a single logger, a
 *   full config object for alogger, or an array of config objects to use for creating log outputs.
 * @param {string} output.level - One of the keys in Log.levels (error, warning, etc.)
 * @param {string} output.type - The name of the logger to use for this output
 */
function Log(output) {
  var i;

  output = output || 2;

  if (_.isString(output) || _.isFinite(output)) {
    output = [
      {
        level: output
      }
    ];
  } else if (_.isPlainObject(output)) {
    output = [output];
  } else if (_.isArray(output)) {
    for (i = 0; i &lt; output.length; i++) {
      if (_.isString(output[i])) {
        output[i] = {
          level: output[i]
        };
      }
    }
  }

  if (!_.isArrayOfObjects(output)) {
    throw new TypeError(&#x27;Invalid Logging output config&#x27;);
  }

  for (i = 0; i &lt; output.length; i++) {
    this.addOutput(output[i]);
  }

}
_.inherits(Log, EventEmitter);

/**
 * Levels observed by the loggers, ordered by rank
 *
 * @property levels
 * @type Array
 * @static
 */
Log.levels = [
  /**
   * Event fired for error level log entries
   * @event error
   * @param {Error} error - The error object to log
   */
  &#x27;error&#x27;
  /**
   * Event fired for &quot;warning&quot; level log entries, which usually represent things like
   * correctly formatted error responses from ES (400, ...) and recoverable errors
   * (one node unresponsive)
   *
   * @event warning
   * @param {String} message - A message to be logged
   */
  , &#x27;warning&#x27;
  /**
   * Event fired for &quot;info&quot; level log entries, which usually describe what a client is doing
   * (sniffing etc)
   *
   * @event info
   * @param {String} message - A message to be logged
   */
  , &#x27;info&#x27;
  /**
   * Event fired for &quot;debug&quot; level log entries, which will describe requests sent, including their
   * url (no data, response codes, or exec times)
   *
   * @event debug
   * @param {String} message - A message to be logged
   */
  , &#x27;debug&#x27;
  /**
   * Event fired for &quot;trace&quot; level log entries, which provide detailed information about each request
   * made from a client, including reponse codes, execution times, and a full curl command that can be
   * copied and pasted into a terminal
   *
   * @event trace
   * @param {Object} params
   * @param {Number} params.status - the HTTP response code from the request
   * @param {String} params.url - The URL from the request
   * @param {String} params.request_body - The body of the request
   * @param {String} params.response_body - The body of the response
   */
  , &#x27;trace&#x27;
];

/**
 * Converts a log config value (string or array) to an array of level names which it represents
 *
 * @method parseLevels
 * @static
 * @private
 * @param  {String|ArrayOfStrings} input - Cound be a string to specify the max level, or an array of exact levels
 * @return {Array} -
 */
Log.parseLevels = function (input) {
  if (_.isString(input)) {
    return _.first(Log.levels, _.indexOf(Log.levels, input) + 1);
  }
  else if (_.isArray(input)) {
    return _.intersection(input, Log.levels);
  }
};

/**
 * Combine the array-like param into a simple string
 *
 * @method join
 * @static
 * @private
 * @param  {*} arrayish - An array like object that can be itterated by _.each
 * @return {String} - The final string.
 */
Log.join = function (arrayish) {
  return _.map(arrayish, function (item) {
    if (_.isPlainObject(item)) {
      return _.inspect(item, { showHidden: true, depth: null, color: true}) + &#x27;\n&#x27;;
    } else {
      return item.toString();
    }
  }).join(&#x27; &#x27;);
};

/**
 * Create a new logger, based on the config.
 *
 * @method addOutput
 * @param {object} config - An object with config options for the logger.
 * @param {String} [config.type=stdio] - The name of an output/logger. Options can be found in the
 *   &#x60;src/loggers&#x60; directory.
 * @param {String|ArrayOfStrings} [config.levels=warning] - The levels to output to this logger, when an
 *   array is specified no levels other than the ones specified will be listened to. When a string is
 *   specified, that and all lower levels will be logged.
 * @return {Logger}
 */
Log.prototype.addOutput = function (config) {
  _.defaults(config, {
    type: &#x27;stdio&#x27;,
    levels: Log.parseLevels(config.levels || config.level || &#x27;warning&#x27;)
  });

  var Logger = require(&#x27;./loggers/&#x27; + config.type);
  return new Logger(config, this);
};

/**
 * Log an error
 *
 * @method error
 * @param  {Error|String} error  The Error to log
 * @return {Boolean} - True if any outputs accepted the message
 */
Log.prototype.error = function (e) {
  if (EventEmitter.listenerCount(this, &#x27;error&#x27;)) {
    return this.emit(&#x27;error&#x27;, e instanceof Error ? e : new Error(e));
  }
};


/**
 * Log a warning message
 *
 * @method warning
 * @param  {*} msg* - Any amount of messages that will be joined before logged
 * @return {Boolean} - True if any outputs accepted the message
 */
Log.prototype.warning = function (/* ...msg */) {
  if (EventEmitter.listenerCount(this, &#x27;warning&#x27;)) {
    return this.emit(&#x27;warning&#x27;, Log.join(arguments));
  }
};


/**
 * Log useful info about what&#x27;s going on
 *
 * @method info
 * @param  {*} msg* - Any amount of messages that will be joined before logged
 * @return {Boolean} - True if any outputs accepted the message
 */
Log.prototype.info = function (/* ...msg */) {
  if (EventEmitter.listenerCount(this, &#x27;info&#x27;)) {
    return this.emit(&#x27;info&#x27;, Log.join(arguments));
  }
};

/**
 * Log a debug level message
 *
 * @method debug
 * @param  {*} msg* - Any amount of messages that will be joined before logged
 * @return {Boolean} - True if any outputs accepted the message
 */
Log.prototype.debug = function (/* ...msg */) {
  if (EventEmitter.listenerCount(this, &#x27;debug&#x27;)) {
    return this.emit(&#x27;debug&#x27;, Log.join(arguments));
  }
};

/**
 * Log a trace level message
 *
 * @method trace
 * @param  {*} msg* - Any amount of messages that will be joined before logged
 * @return {Boolean} - True if any outputs accepted the message
 */
Log.prototype.trace = function (/* ...msg */) {
  if (EventEmitter.listenerCount(this, &#x27;trace&#x27;)) {
    return this.emit(&#x27;trace&#x27;, Log.join(arguments));
  }
};

/**
 * Shortcut for formatting a response trace message, which won&#x27;t go through the trouble of formatting
 * the message if nothing will be receiving the message.
 *
 * @method requestTrace
 * @param  {string} method - The HTTP method from the request
 * @param  {string} url - The URL from the request
 * @param  {string} body - The JSON body from the request
 * @param  {string} responseStatus - The HTTP response&#x27;s status code
 * @param  {string} responseBody - The HTTP response&#x27;s body
 * @return {Boolean} - True if any outputs accepted the message
 */
Log.prototype.traceResponse = function (method, url, body, responseStatus, responseBody) {
  var message;

  if (EventEmitter.listenerCount(this, &#x27;trace&#x27;)) {
    message = &#x27;curl &quot;&#x27; + url.replace(&#x27;&quot;&#x27;, &#x27;\\&quot;&#x27;) + &#x27;&quot; -X&#x27; + method.toUpperCase();
    if (body) {
      message += &#x27; -d &#x27; + JSON.stringify(body);
    }
    return this.emit(&#x27;trace&#x27;, message);
  }
};


module.exports = Log;
  </pre>
</div>

          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="../assets/vendor/jquery/jquery-1.10.2.min.js"></script>
  <script src="../assets/vendor/bootstrap/js/bootstrap.js"></script>
  <script src="../assets/vendor/prettify/prettify-min.js"></script>
  <script src="../assets/js/main.js"></script>
</body>
</html>
